# Pre-commit Checks Workflow

This Cline Workflow runs the same checks as the GitHub CI pipeline to ensure code quality before committing changes.

## Overview

This workflow mirrors the GitHub CI pipeline's lint and test jobs, allowing you to run the same checks locally that will be executed in CI. The workflow is automatically synchronized with `.github/workflows/ci.yml` to ensure consistency.

## Usage

To run this workflow, execute the following command in Cline:
```
Use workflow: pre-commit-checks
```

Or reference specific steps:
```
Run step: install-dependencies
Run step: lint-checks
Run step: unit-tests
```

## Workflow Steps

### Step 1: Install Dependencies
```bash
# Upgrade pip and install linting tools
python -m pip install --upgrade pip
pip install black flake8 isort mypy

# Install the package in development mode
pip install -e .
```

### Step 2: Code Formatting Check (Black)
```bash
# Check code formatting with Black
# Excludes automatically generated _version.py file
black --check --extend-exclude="src/bestehorn_llmmanager/_version.py" src/ test/
```

**Expected Result**: All Python files should be properly formatted according to Black's standards.

### Step 3: Import Sorting Check (isort)
```bash
# Check import sorting with isort
# Skips automatically generated _version.py file
isort --check-only --skip="src/bestehorn_llmmanager/_version.py" src/ test/
```

**Expected Result**: All imports should be sorted according to isort configuration in pyproject.toml.

### Step 4: Linting Check (flake8)
```bash
# Lint with flake8
# Excludes automatically generated _version.py file
flake8 --exclude="src/bestehorn_llmmanager/_version.py" src/ test/
```

**Expected Result**: Code should pass all flake8 linting rules without errors.

### Step 5: Type Checking (mypy)
```bash
# Type check with mypy
# Excludes automatically generated _version.py file
mypy --exclude="_version" src/
```

**Expected Result**: All type annotations should be correct and no type errors should be present.

## Optional Extended Checks

### Step 6: Unit Tests (Optional)
```bash
# Install test dependencies
pip install -e .[dev]

# Run unit tests with coverage
pytest test/bestehorn_llmmanager/ -v --cov=bestehorn_llmmanager --cov-report=term-missing --ignore=test/integration/
```

**Expected Result**: All unit tests should pass with adequate code coverage.

### Step 7: Package Build Check (Optional)
```bash
# Install build dependencies
pip install build twine check-manifest

# Check MANIFEST.in
check-manifest

# Build package
python -m build

# Check package
twine check dist/*
```

**Expected Result**: Package should build successfully and pass all validation checks.

## Troubleshooting

### Common Issues and Solutions

#### Black Formatting Issues
```bash
# Fix formatting issues automatically
black --extend-exclude="src/bestehorn_llmmanager/_version.py" src/ test/
```

#### Import Sorting Issues
```bash
# Fix import sorting automatically
isort --skip="src/bestehorn_llmmanager/_version.py" src/ test/
```

#### Flake8 Linting Issues
- Review the specific error messages and fix code style issues
- Common issues include line length, unused imports, undefined variables

#### MyPy Type Issues
- Add missing type annotations
- Fix type mismatches
- Consider using `# type: ignore` comments for unavoidable issues

## Configuration Files

This workflow uses configuration from:
- `pyproject.toml` - Black, isort, pytest, and mypy configuration
- `.github/workflows/ci.yml` - Source of truth for CI pipeline commands

## Synchronization Note

This workflow is automatically synchronized with the GitHub CI pipeline. When the CI workflow changes, this file should be updated to match. The synchronization ensures that local pre-commit checks mirror exactly what will run in CI.

## Quick Fix Commands

If any checks fail, you can use these commands to automatically fix common issues:

```bash
# Fix all formatting and import issues
black --extend-exclude="src/bestehorn_llmmanager/_version.py" src/ test/
isort --skip="src/bestehorn_llmmanager/_version.py" src/ test/

# Run a quick check after fixes
black --check --extend-exclude="src/bestehorn_llmmanager/_version.py" src/ test/ && \
isort --check-only --skip="src/bestehorn_llmmanager/_version.py" src/ test/ && \
flake8 --exclude="src/bestehorn_llmmanager/_version.py" src/ test/ && \
mypy --exclude="_version" src/
```

## Notes

- The `_version.py` file is automatically generated by setuptools-scm and should be excluded from all checks
- All commands should be run from the project root directory
- This workflow matches the GitHub CI pipeline's lint job exactly
- Test execution is optional for pre-commit but recommended for significant changes
