{
  "enabled": true,
  "name": "Test Automation Workflow",
  "description": "Comprehensive test automation workflow including coverage analysis, test generation, quality checks, and documentation updates",
  "version": "1",
  "when": {
    "type": "manual"
  },
  "then": {
    "type": "askAgent",
    "prompt": "Execute the comprehensive test automation workflow:\n\n1. **Verify Virtual Environment**: Confirm that the virtual environment is activated. If not, activate it using: venv\\Scripts\\activate\n\n2. **Generate Coverage Report**:\n   - Run: venv\\Scripts\\activate & pytest test/ --cov=src/bestehorn_llmmanager --cov-report=term-missing --cov-report=html --cov-fail-under=80\n   - Note the current coverage percentage\n   - Identify which files and lines are not covered\n   - Generate HTML report for detailed analysis\n\n3. **Analyze Coverage Gaps**:\n   - Review the coverage report to identify uncovered code\n   - Prioritize critical paths and core functionality that lack coverage:\n     * LLMManager core methods (invoke, invoke_with_retry, streaming)\n     * MessageBuilder fluent interface methods\n     * UnifiedModelManager model availability checks\n     * BedrockCatalog data fetching and caching\n     * Error handling paths in all components\n   - Identify edge cases that need testing\n   - List specific functions/methods that need test coverage\n\n4. **Implement Missing Tests**:\n   - For each uncovered critical path, create appropriate tests\n   - Test location: test/ directory (mirrors src/ structure)\n   - For src/bestehorn_llmmanager/x.py, create test/bestehorn_llmmanager/test_x.py\n   - Focus on:\n     * Unit tests for core logic\n     * Integration tests in test/integration/ for AWS Bedrock interactions\n     * Property-based tests using hypothesis where applicable\n     * Edge cases and error conditions\n   - Use pytest fixtures for common setup\n   - Mock external dependencies appropriately\n\n5. **Run Full Test Suite**:\n   - Run: venv\\Scripts\\activate & pytest test/ --cov=src/bestehorn_llmmanager --cov-report=term-missing --cov-fail-under=80\n   - Verify all tests pass\n   - Check that coverage has increased\n   - If tests fail, analyze failures and fix code or tests as needed\n\n6. **Fix Test Failures**:\n   - If any tests fail, analyze the failure:\n     * Is it a bug in the implementation?\n     * Is it a bug in the test?\n     * Is it an incorrect assumption?\n   - Fix the root cause (code or test)\n   - Re-run tests until all pass\n   - Do not proceed until all tests pass\n\n7. **Run Quality Checks**:\n   - Run: venv\\Scripts\\activate & black src/ test/ scripts/ --check --extend-exclude=\"src/bestehorn_llmmanager/_version.py\"\n   - Run: venv\\Scripts\\activate & isort src/ test/ scripts/ --check-only --skip=\"src/bestehorn_llmmanager/_version.py\"\n   - Run: venv\\Scripts\\activate & flake8 src/ test/ scripts/ --max-line-length=100 --extend-ignore=E203,W503 --exclude=\"src/bestehorn_llmmanager/_version.py\"\n   - Run: venv\\Scripts\\activate & mypy --exclude=\"_version\" src/\n   - Run: venv\\Scripts\\activate & bandit -r src/ scripts/ -x \"src/bestehorn_llmmanager/_version.py\"\n   - Fix any issues found before continuing\n\n8. **Update Documentation**:\n   - Update docs/ to reflect any changes made during testing\n   - Update docs/forLLMConsumption.md with any new testing insights\n   - Document any new test utilities or fixtures created\n   - Update test coverage information in documentation\n\n9. **Report Results**:\n   - Initial coverage percentage\n   - Final coverage percentage\n   - Number of tests added (by category: unit, integration, property-based)\n   - List of specific test files created or modified\n   - Summary of test failures encountered and how they were resolved\n   - Results of quality checks (pass/fail for each tool)\n   - Any remaining coverage gaps and justification for not covering them\n   - Confirmation that all tests pass and coverage target is met\n\n**Coverage Target**: 80% minimum (as configured in pyproject.toml)\n\n**Project-Specific Notes**:\n- Always exclude src/bestehorn_llmmanager/_version.py from all checks (it's auto-generated)\n- Line length is 100 characters (not 120)\n- Use Windows activation command: venv\\Scripts\\activate\n- Package path for coverage: src/bestehorn_llmmanager\n- Integration tests requiring AWS Bedrock access go in test/integration/\n- Use hypothesis for property-based testing where applicable\n\n**CRITICAL**: Do not consider this workflow complete until:\n- All tests pass\n- Coverage meets or exceeds 80%\n- All quality checks pass\n- Documentation is updated"
  }
}
